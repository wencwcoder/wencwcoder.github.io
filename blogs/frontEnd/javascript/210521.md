---
title: JavaScript代码小技巧
date: 2021-05-21
categories:
 - 前端
tags:
 - JavaScript
---

<!-- more -->



## 1. 如何判断元素是否在可视区域

#### 方法一

1. 通过`document.documentElement.clientHeight`获取屏幕可视窗口高度
2. 通过`element.offsetTop`获取元素相对于文档顶部的距离
3. 通过`document.documentElement.scrollTop`获取浏览器窗口顶部与文档顶部之间的距离，也就是滚动条滚动的距离

然后判断②-③<①是否成立，如果成立，元素就在可视区域内。



#### 方法二 getBoundingClientRect

通过`getBoundingClientRect()`方法来获取元素的大小以及位置。

假设`const bound = el.getBoundingClientRect();`来表示图片到可视区域顶部距离；
并设 `const clientHeight = window.innerHeight;`来表示可视区域的高度。

随着滚动条的向下滚动，`bound.top`会越来越小，也就是图片到可视区域顶部的距离越来越小，当`bound.top===clientHeight`时，图片的上沿应该是位于可视区域下沿的位置的临界点，再滚动一点点，图片就会进入可视区域。

也就是说，在`bound.top<=clientHeight`时，图片是在可视区域内的。

```javascript
function isInSight(el) {
  const bound = el.getBoundingClientRect();
  const clientHeight = window.innerHeight;
  //如果只考虑向下滚动加载
  //const clientWidth = window.innerWeight;
  return bound.top <= clientHeight + 100;
}
```



## 2. 如何判断对象是否为空

```javascript
const obj = {};

Object.keys(obj).length === 0  // true 则为空对象
Object.keys(obj).length === 0 && obj.constructor === Object
```

为什么还要额外判断对象的`constructor`呢？即构造函数呢？

在 JavaScript 中，有9个内置构造函数。

```javascript
new Object();
new String();
new Number();
new Boolean();
new Array();
new RegExp();
new Function();
new Date();
new Error();
```

我们可以使用这些构造函数来创建对象，例如：`new Object()`(日常不推荐使用)。

```javascript
const obj = new Object();

Object.keys(obj).length === 0; // true
```

平常使用的判断方法也没问题啊🤔🤔🤔

但是当使用剩下的内置构造函数创建就会出现问题。

```javascript
function badEmptyCheck(value) {
    return Object.keys(value).length === 0;
}

badEmptyCheck(new String()); // true
badEmptyCheck(new Number()); // true
badEmptyCheck(new Boolean()); // true
badEmptyCheck(new Array()); // true
badEmptyCheck(new RegExp()); // true
badEmptyCheck(new Function()); // true
badEmptyCheck(new Date()); // true
badEmptyCheck(new Error();); // true
```

是不是有点明白了？在添加构造函数判断后：

```javascript
function goodEmptyCheck(value) {
    return Object.keys(value).length === 0 && value.constructor === Object;
}

goodEmptyCheck(new String()); // false
goodEmptyCheck(new Number()); // false
goodEmptyCheck(new Boolean()); // false
goodEmptyCheck(new Array()); // false
goodEmptyCheck(new RegExp()); // false
goodEmptyCheck(new Function()); // false
goodEmptyCheck(new Date()); // false
goodEmptyCheck(new Error();); // false
```

结果正确，实际上是我们对边界情况进行了处理。

```javascript
Object.keys(null).length === 0;   // TypeError
Object.keys(undefined).length === 0;  // TypeError
```

总结：`badEmptyCheck`和`goodEmptyCheck`两个方法的区别主要在于添加了对边界情况的处理，所以后者更适用于公共组件和一些库上。

```javascript
function goodEmptyCheck(value) {
    return value && Object.keys(value).length === 0 && value.constructor === Object;
}
```



## 3. 清空和截短数组--改变 length 属性

```javascript
const arr = [1,2,3,4,5,6,7,8,9];
arr.length = 5;
console.log(arr); //[1,2,3,4,5]
arr.length = 0; //清空数组
```



## 4. 数组求和

```javascript
var numbers = [3, 5, 7, 2];
var sum = numbers.reduce((x, y) => x + y);
console.log(sum); // returns 17
```



## 5. 条件短路

```javascript
if (hungry) {
    goToFridge();
}

// 进一步简化代码，同时使用变量和函
hungry && goToFridge()
```



## 6. 动态属性名称

```javascript
const dynamic = 'flavour';
var item = {
    name: 'Coke',
    [dynamic]: 'Cherry'
}
console.log(item); 
// { name: "Coke", flavour: "Cherry" }
```



## 7. 一些屏蔽事件操作

- 彻底屏蔽鼠标右键

```javascript
oncontextmenu=”window.event.returnValue=false”
< table border oncontextmenu=return(false)>< td>no< /table> 可用于 Table
```

- 取消选取、防止复制

```javascript
< body onselectstart=”return false”>
    
// css
user-select: none;
```

- JS 不允许粘贴

```javascript
onpaste=”return false”
```

- JS 防止复制

```javascript
oncopy=”return false;” oncut=”return false;”
```

- 禁用输入法

```javascript
< input style=”ime-mode:disabled”>
```

- 防止被人 frame

```javascript
if (top.location != self.location)top.location=self.location;
```

- 网页禁用另存为

```javascript
< no>< iframe src=*.html>< /iframe>< /no>
```



## 8. 数组去重

```javascript
// Hash:
function unique(arr = []) {
  if (arr.length === 0 || arr.length === 1) {
    return arr;
  }
  const newArray = [];
  const hash = {};
  for (let i = 0; i < arr.length; i++) {
    if (!hash[arr[i]]) {
      hash[arr[i]] = 1;
      newArray.push(arr[i]);
    }
  }
  return newArray;
}

// Set:
function unique(arr = []) {
  if (arr.length === 0 || arr.length === 1) {
    return arr;
  }
  return [...new Set(arr)];
}
```



## 9. 文件的读取

```javascript
<input type='file' id='f' />
<div></div>

fileInput.onchange = function() {
    const file = this.files[0];
    const fr = new FileReader();
    fr.readAsText(file);
    fr.onload = function() {
        const result = fr.result;
        // 其它处理
        const st = document.createElement('style');
        st.innerHTML = result;
        document.querySelector('head').appendChild(st);
    }
}
```



## 10. 网络状态检测

```javascript
const state = window.navigator.onLine; // boolean

window.ononline = function() {
	alert('good');
};
window.onoffline = function() {
    alert('bad');
}
```

